#!/usr/bin/python

import urllib2
import httplib
import sys
import time
import urlparse

import lxml.etree

UA = "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.8) Gecko/20100724 Firefox/3.6.8"

headers = {'User-Agent': UA}
id = urlparse.parse_qs(urlparse.urlparse(sys.argv[1]).query)['f'][0]
opener = urllib2.build_opener(urllib2.HTTPCookieProcessor)
opener.open(urllib2.Request(sys.argv[1], headers = headers)).read()

url = "http://www.megaupload.com/xml/folderfiles.php?folderid=%s&uniq=%s" % (id, str(int(time.time())) + "42")
data = opener.open(urllib2.Request(url, headers = headers)).read()
for url in lxml.etree.XML(data).xpath('//@url'):
	print url
