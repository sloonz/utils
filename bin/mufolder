#!/usr/bin/python

import urllib.request, urllib.parse
import sys
import time
import urllib.parse

import lxml.etree

UA = "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.8) Gecko/20100724 Firefox/3.6.8"

headers = {'User-Agent': UA}
id = urllib.parse.parse_qs(urllib.parse.urlparse(sys.argv[1]).query)['f'][0]
opener = urllib.request.build_opener(urllib.request.HTTPCookieProcessor)
opener.open(urllib.request.Request(sys.argv[1], headers = headers)).read()

url = "http://www.megaupload.com/xml/folderfiles.php?folderid=%s&uniq=%s" % (id, str(int(time.time())) + "42")
data = opener.open(urllib.request.Request(url, headers = headers)).read()
for url in lxml.etree.XML(data).xpath('//@url'):
	print(url)
