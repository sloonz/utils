#!/usr/bin/perl -w

use strict;

my $tnum;
my $ttype;
my $tcodec;
my $tlang;
my $tname;

my $amime;
my $afile;
my $aid;

my $pre = "";

foreach my $file (@ARGV) {
	next if $file =~ /^-/;
	
	$pre = "$file : " if $#ARGV;
	
	foreach (split /\n/, `mkvinfo "$file"`) {
		$aid = $1 if  /File UID: (\d+)$/;
		$amime = $1 if  /Mime type: (.+)$/;
		$afile = $1 if  /File name: (.+)$/;
		
		$tnum = $1 if /Track number: (\d+)$/;
		$ttype = $1 if /Track type: (audio|video|subtitles)$/;
		$tcodec = $1 if /Codec ID: (.+)$/;
		$tlang = $1 if /Language: (.+)$/;
		$tname = $1 if /Name: (.+)$/;
		
		if(/^\| ?\+/ && defined($tnum)) {
			$tname = " : $tname" if $tname;
			$tname ||= "";
			print "${pre}$ttype $tnum : $tcodec $tlang$tname\n";
		}
		elsif(/^\| ?\+/ && defined($aid)) {
			print "${pre}attachment $aid : $afile $amime\n";
		}
		
		if(/^\| ?\+/) {
			undef $tnum;
			undef $ttype;
			undef $tcodec;
			undef $tlang;
			undef $tname;

			undef $amime;
			undef $afile;
			undef $aid;
		}
	}
}
